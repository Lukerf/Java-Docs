## 1. 分层架构

微服务架构模型有好多种，例如整洁架构、CQRS 和六边形架构等等。每种架构模式虽然提出的时代和背景不同，但其核心理念都是为了设计出“高内聚低耦合”的架构，轻松实现架构演进。而 DDD 分层架构的出现，使架构边界变得越来越清晰，它在微服务架构模型中，占有非常重要的位置。

<img src="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/DDD%e5%ae%9e%e6%88%98%e8%af%be/assets/a308123994f87a5ce99adc85dd9b4d01.jpg" alt="img" style="zoom: 33%;" />

### 1.1 用户接口层

用户接口层负责向用户显示信息和解释用户指令。这里的用户可能是：用户、程序、自动化测试和批处理脚本等等。

### 1.2 应用层

应用服务是在应用层的，它负责服务的组合、编排和转发，负责处理业务用例的执行顺序以及结果的拼装，以粗粒度的服务通过 API 网关向前端发布。接收前台需求，随时做出响应和调整，尽量避免将前台需求传导到领域层，还有，应用服务还可以进行安全认证、权限校验、事务控制、发送或订阅领域事件等。

### 1.3 领域层

领域层的作用是实现企业核心业务逻辑，通过各种校验手段保证业务的正确性。领域层主要体现领域模型的业务能力，它用来表达业务概念、业务状态和业务规则。

### 1.4 基础层

为其它各层提供通用的技术和基础服务，包括第三方工具、驱动、消息中间件、网关、文件、缓存以及**数据库**等

DDD 分层架构的数据库等基础资源访问，采用了仓储（Repository）设计模式，通过依赖倒置实现各层对基础资源的解耦。

仓储又分为两部分：仓储接口和仓储实现。仓储接口放在领域层中，仓储实现放在基础层。原来三层架构通用的第三方工具包、驱动、Common、Utility、Config 等通用的公共的资源类统一放到了基础层。





## 架构分层

### 项目级微服务

项目级微服务的内部遵循分层架构模型就可以了。领域模型的核心逻辑在领域层实现，服务的组合和编排在应用层实现，通过 API 网关为前台应用提供服务，实现前后端分离。

### 企业级中台微服务

企业级中台微服务的集成不能像项目级微服务一样，在某一个微服务内完成跨微服务的服务组合和编排。

可以在中台微服务之上增加一层，处理跨中台微服务的服务组合和编排，以及微服务之间的协调，这一层没有领域服务，只有不同微服务的服务组合和编排。

![img](https://raw.githubusercontent.com/Lukerf/Java-Docs/master/image/eeb66579c1725817d0e9185161f1843b.png)