### 如何进行主从同步

#### 方式

读写分离，只在主库上面更新，然后再同步到从库；如果写多份，到每一个实例，那和单例没区别。如果随机写一个库，那就会设计到很多数据不一致，加锁的问题。



#### 命令

#### 在从库执行 replicaof(5.0之前用slaveof)，该实例就成了另一个实例的从库



#### 原理

1. 首次连接以后全量复制：通过发送RDB文件，然后从库通过RDB完成本地加载进行同步

2. 复制期间产生的命令，都记录在replication buffer中，之后也通过replication buffer 进行同步。

3. 如果主从断连以后，主库通过repl_backlog_buffer记录和从库的偏移量。repl_backlog_buffer是一个环形结构，可能会出现覆盖，所以如果断连太久，需要全量复制。

   

#### 主-从-从模式减少主库压力

即也是通过replicaof命令建立从库之间的联系，这样从库更新的时候，会更新他下面的从库



### 主库挂了，怎么办



### 