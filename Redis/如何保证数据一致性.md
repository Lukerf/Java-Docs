### 1. 缓存策略

#### 1.1 读写缓存

- 同步直写策略：写缓存时，也同步写数据库，缓存和数据库中的数据一致； 对一致性要求高
- 异步写回策略：写缓存时不同步写数据库，等到数据从缓存中淘汰时（淘汰策略），再写回数据库。使用这种策略时，如果数据还没有写回数据库，缓存就发生了故障，那么，此时，数据库就没有最新的数据了。 对一致性要求没那么高

#### 1.2 只读缓存

大部分场景都是使用只读缓存，修改时，直接写入数据库，并且失效原有缓存值。 这样后续访问则会从数据库中查找，然后再写入缓存，而且建议是先更新数据库，再删除缓存，原因是先删缓存，此时缓存中没有数据，数据库会有很高的请求压力，另一个是延迟双删的时间不好设置。



### 2. 如何保证数据一致性

写回策略必须是同步写回

1. 删除缓存或者更新数据库出现失败，重试机制，由于修改数据时需要删除缓存，以及更新数据库； 可以把操作放入消息队列中，出现失败时，使用消息队列重试（无并发操作）
2. 没有失败时，高并发情况也会出现数据不一致的情况，解决方案如下

<img src="E:\学习资料\笔记\Java-Docs\image\数据不一致问题解决方案.jpg" style="zoom: 25%;" />

