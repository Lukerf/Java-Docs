两种写回策略

- 同步直写策略：写缓存时，也同步写数据库，缓存和数据库中的数据一致； 对一致性要求高
- 异步写回策略：写缓存时不同步写数据库，等到数据从缓存中淘汰时，再写回数据库。使用这种策略时，如果数据还没有写回数据库，缓存就发生了故障，那么，此时，数据库就没有最新的数据了。 对一致性要求没那么高

只读缓存：修改时，直接写入数据库，并且失效原有缓存值。 这样后续访问则会从数据库中查找，然后再写入缓存



在没有并发的时候，如果出现删缓存，或者更新数据库失败，则可以通过消息队列重试机制解决

如果没有出现失败，也可能会由于并发的问题出现数据不一致，而通过以下方式解决

修改和删除数据的步骤

1. 第一种方式，先删缓存，在修改数据库

   出现数据不一致的解决方案：

   ​	更新数据库以后，sleep线程，然后再删一遍缓存，避免在修改数据库时，其他线程读了数据库的旧值到缓存中（延迟双删）

2. 第二种方式，先修改数据库，再删缓存

   在数据库修改完以后，还没同步到缓存时，其他线程可能会读到旧值，不过影响不大。

### 如何保证数据一致性

1. 重试机制，由于修改数据时需要删除缓存，以及更新数据库； 可以把操作放入消息队列中，出现失败时，使用消息队列重试（无并发操作）

   

<img src="E:\学习资料\笔记\Java-Docs\image\数据不一致问题解决方案.jpg" style="zoom: 25%;" />