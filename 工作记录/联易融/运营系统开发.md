### 1. 需求背景和资料

#### 流程节点

- usr_materialinput               --资料整理节点
- usr_materialcheck               --资产查验节点
- usr_riskFstCheck               --风控初审节点
- usr_riskSndCheck               --风控复审节点



### 2.公共需求

#### 1.1 列表和搜索条件优化

##### 需求描述

运营系统所有涉及到的主列表和搜索条件，新增列表和搜索条件筛选功能，通过勾选字段显示列表字段和搜索条件

##### 设计方案

前端修改



#### 1.2 工作台优化

##### 需求描述

1. 底层审核和融资审核工作台以下搜索条件下拉支持多项选择

​          ➢ 【底层审核：待领取、待办理、已完成】：任务名称、审批结果、经办人；

​          ➢ 【融资审核：待领取、待办理、已完成】：任务名称、项目名称、经办人；

##### 设计方案

1. 

   前端: 对应字段的过滤改为多选

   后端:

   需要做接口调整的如下：

   待办理-经办人：currUserId查询过滤参数改为传递多个，eq改为in

   已完成-经办人：currUserId查询过滤参数改为传递多个，eq改为in

   已完成-审批结果：auditState查询过滤参数改为传递多个，eq改为in

   


#### 1.3 贸易合同列表优化

##### 需求描述

        1)     贸易合同列表操作列，如合同存在转让记录的，则资产已审核通过，则在操作列展示【转让记录】按钮，点击后，弹框显示合同转让记录，显示所有使用该笔合同的资产信息，如该笔资产有备注则显示备注内容，否则显示“--”

        2)     当某笔资产向下有N笔合同，只要其中一笔与当前资产关联的合同编号+合同名称一样，则在弹框里显示该笔资产；
        3)     弹框列表字段有序号合同编号、合同名称、转让金额、审核状态、创建时间、风控初审人员、风控复审人员、风控初审流转时间、复审通过时间、备注；

##### 设计方案

1. 贸易合同列表操作列，如合同存在转让记录的，则资产已审核通过，则在操作列展示【转让记录】按钮？

   前端：样式修改

   后端：

   1. 通过 “合同编号+合同名称” 查询所有合同数据List
   2. 获取所有合同的assetNo，通过assetNo查询对应资产
   3. 获取所有资产id，调用工作流接口查询资产的工作流，并且审批节点类型为usr_riskFstCheck（风控初审节点)和usr_riskSndCheck（风控复审节点）
   4. 拼接VO

   

   | 序号 | 字段名称         | 数据来源                      | 说明                                         |
   | ---- | ---------------- | ----------------------------- | -------------------------------------------- |
   | 1    | 合同编号         | 合同信息表.合同编号           |                                              |
   | 2    | 合同名称         | 合同信息表.合同名称           |                                              |
   | 3    | 转让金额         | 合同信息表.合同金额           |                                              |
   | 4    | 审核状态         |                               |                                              |
   | 5    | 创建时间         | 合同信息表.创建时间           |                                              |
   | 6    | 风控初审人员     | 风控初审节点Task.人员         |                                              |
   | 7    | 风控复审人员     | 风控复审节点Task.人员         | 没有该节点则显示“--”                         |
   | 8    | 风控初审流转时间 | 风控初审节点Task.任务开始时间 |                                              |
   | 9    | 复审通过时间     | 风控复审节点Task.任务开始时间 | 没有该节点则显示“--”                         |
   | 10   | 备注             | 可编辑字段                    | 如列表有N条资产进行了备注，则备注后显示（N） |

 2. 

    前端：备注交互

    后端：合同表增加“备注”字段，并提供更新“备注”接口

#### 1.4 影像格式优化

##### 需求描述

业务系统推送文件格式需支持xlsx, docx, jpg, gif, xls, doc, pdf, png, bmp, jpeg格式文件外，新增支持ZIP格式文件，ZIP格式不支持影像树查看，放大、缩小、旋转等功能，仅提供下载、删除功能；

##### 设计方案

1. 

   后端：

   media_category 影像文件目录表

   media_category_file 影像文件目录文件类型表，在这个表对每一种目录类型都增加一条zip类型的数据

##### 存疑

对所有目录增加校验还是对部分目录增加校验



#### 1.5 资料整理岗

##### 需求描述

1. 原始资产审核和融资审核在影像树下的其他补充资料文件新增“调整分类”功能；

   ![image-20231128153903596](https://raw.githubusercontent.com/Lukerf/Java-Docs/master/image/image-20231128153903596.png?token=AHPLFCKT7JXVUYH44DVVU43FMWMVI)

2.  底层和融资审核在资产整理岗提交审核通过时，需校验合同金额是否大于或等于应付账款金额，如是则提交成功，否则弱提示“合同汇总金额少于应付账款金额，确定是否提交”，点击【确认】提交成功，点击【取消】则停留在此页面；

##### 设计方案

1. 

   前端：样式调整，调整分类可以调用已有接口 /media/opera/do/changeFileCatg

2. 

   后端：
   
   1. finContractValidator 提交接口增加校验，	
   2. 



#### 1.6 资产查验岗

##### 需求描述

1. 资料整理、查验、风控岗在合同/订单信息下方新增显示合同/订单总金额；    

2. 原始资产审核和融资审核资产查验岗审核意见选择贸易合有转让记录或贸易合同和发票有转让记录时，上方的快捷回复设置里的汇总合同金额需自动填充本笔资产的合同/订单总金额；

3.  底层审核和融资审核在资产查验节点时，影像树下的中登登记相关文件夹需放开新增和删除权限；

4. 底层审核和融资审核在中登查询页面，右上角增加【回传查询证明】按钮，自动把查询证明文件转化为PDF文件，命名为“中登查询证明”的文件放至影像树“企业信息核查结果”文件夹下；

   ![image-20231204160438434](https://raw.githubusercontent.com/Lukerf/Java-Docs/master/image/image-20231204160438434.png?token=AHPLFCOMNESOAHPXLHIVWL3FNWEFG)

##### 设计方案

1. 增加合同订单总金额查询接口：查询改资产下的所有合同并统计。
2. 同上
3. 

#### 1.7 风控审核岗

##### 需求描述

1. 风控界面办理审核，在资产审核TAB页审核时，点击[提交] 按钮时，如有核查项不通过，提示语弹框会在由审批轨进界面提示“存在未通过的核查项”，现需调整为资产审批TAB界面显示提示信息;
