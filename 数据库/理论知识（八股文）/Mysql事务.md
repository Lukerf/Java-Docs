事务的原理

一致性视图：

1. 每个事务在启动的时候都会申请一个严格递增的事物id，而且每行数据都有多个版本，每个版本都有row trx_id
2. undo log记录了事物的反向行为，也就是通过undo log 和当前版本可以计算出每行数据之前的版本数据
3. 而数据的可见性规则就是：事务启动时记录活跃事务id数组（最小值记为低水位），和高水位（当前创建过的事物ID最大值+1）

<img src="E:\学习资料\笔记\Java-Docs\image\数据版本可见性.jpg" style="zoom:50%;" />

row trx_id是事务id，即行数据的版本id，事务生效后赋值给这个版本

如果落在黄色部分，那就包括两种情况

a. 若 row trx_id 在数组中，表示这个版本是由还没提交的事务生成的，不可见；

b. 若 row trx_id 不在数组中，表示这个版本是已经提交了的事务生成的，可见。